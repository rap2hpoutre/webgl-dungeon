/*! webgl-dungeon 2014-04-16 */
var Hyacinthe=function(a,b){var c=function(c){if(!a.isMoving&&e(c)){a.isMoving=!0;var d=a.compass[0];b.startCameraMovement("N"==d||"S"==d?"x":"z","N"==d||"E"==d?-1*c:c,function(b){return function(){a.playerPosition.y+="N"==d?-1*c:"S"==d?c:0,a.playerPosition.x+="E"==d?-1*c:"W"==d?c:0,b.isMoving=!1}}(a))}},d=function(c){a.isMoving||(a.isMoving=!0,b.startCameraRotation(1*c,function(a,b){return function(){a.isMoving=!1,1==b?a.compass.unshift(a.compass.pop()):a.compass.push(a.compass.shift()),console.log(a.compass[0])}}(a,c)))},e=function(b){var c=a.compass[0],d="N"==c&&0==a.collisionMap[a.playerPosition.y-b][a.playerPosition.x]||"S"==c&&0==a.collisionMap[a.playerPosition.y+b][a.playerPosition.x]||"W"==c&&0==a.collisionMap[a.playerPosition.y][a.playerPosition.x+b]||"E"==c&&0==a.collisionMap[a.playerPosition.y][a.playerPosition.x-b];return d};return a.compass=["E","S","W","N"],a.isMoving=!1,a.collisionMap=[],a.playerPosition={x:0,y:0},a.turnLeft=function(){d(1)},a.turnRight=function(){d(-1)},a.moveForward=function(){c(1)},a.moveBack=function(){c(-1)},a}(Hyacinthe||{},Marvin,this),Isis=function(a){for(var b=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1],[1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1],[1,3,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1],[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,2,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1]],c=0;c<b.length;c++)b[c].reverse();return a.isWall=function(a){return 1==a?!0:void 0},a.buildTestLevel=function(a){for(var c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++)1==b[c][d]?a.drawCube(c,d):2==b[c][d]?a.setCameraPosition(c,d):3==b[c][d]&&a.drawSprite(c,d);a.drawFloor(b.length,b[0].length)},a.getCollisionMap=function(){for(var c=[],d=0;d<b.length;d++){c[d]=[];for(var e=0;e<b[d].length;e++)c[d][e]=a.isWall(b[d][e])?1:0}return c},a.getPlayerPosition=function(){for(var a=0;a<b.length;a++)for(var c=0;c<b[a].length;c++)if(2==b[a][c])return{x:c,y:a}},a}(Isis||{},this),Marvin=function(a){var b,c,d,e,f=null,g=null,h=new THREE.Scene;h.fog=new THREE.Fog(new THREE.Color(0),1,10);var i=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),j=new THREE.WebGLRenderer;j.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(j.domElement);var k=THREE.ImageUtils.loadTexture("images/1.png");k.magFilter=THREE.NearestFilter;var l=THREE.ImageUtils.loadTexture("images/gold.png");l.magFilter=THREE.NearestFilter;var m=new THREE.SpriteMaterial({map:l,color:16777215,fog:!0}),n=2,o=new THREE.CubeGeometry(n,n,n),p=new THREE.MeshBasicMaterial({map:k}),q=function(){null!==f&&(i.rotation.y+=.1*b,(1==b&&i.rotation.y>f||-1==b&&i.rotation.y<f)&&(i.rotation.y=f,f=null,"function"==typeof d&&d()))},r=function(){null!==g&&(i.position[c]+=.1*b,(1==b&&i.position[c]>g||-1==b&&i.position[c]<g)&&(i.position[c]=g,g=null,"function"==typeof e&&e()))},s=function(){requestAnimationFrame(s),q(),r(),j.render(h,i)};return a.drawCube=function(a,b){var c=new THREE.Mesh(o,p);h.add(c),c.position.z=n*b,c.position.x=n*a},a.drawSprite=function(a,b){var c=new THREE.Sprite(m);c.position.z=n*b,c.position.x=n*a,c.position.y=-.5,h.add(c)},a.drawFloor=function(a,b){var c=new THREE.PlaneGeometry(a*n,b*n),d=new THREE.MeshBasicMaterial({color:4473924}),e=new THREE.Mesh(c,d);e.rotation.x=Math.PI+Math.PI/2,e.position.y=-1,e.position.z=n*(b/2),e.position.x=n*(a/2);var f=new THREE.Mesh(c,d);f.rotation.x=Math.PI/2,f.position.y=1,f.position.z=n*(b/2),f.position.x=n*(a/2),h.add(e),h.add(f)},a.setCameraPosition=function(a,b){i.position.z=n*b,i.position.y=0,i.position.x=n*a},a.startRender=function(){s()},a.startCameraRotation=function(a,c){b=a,d=c,f=i.rotation.y+Math.PI/2*b,console.log(i.rotation.y,f)},a.startCameraMovement=function(a,d,f){b=d,c=a,e=f,g=i.position[c]+2*b,console.log(i.position[c],g)},a}(Marvin||{},this);!function(a,b,c){c.buildTestLevel(a),b.collisionMap=c.getCollisionMap(),b.playerPosition=c.getPlayerPosition(),a.startRender(),this.addEventListener("keypress",function(a){a.preventDefault();var c=a.keyCode||a.which;113==c?b.turnLeft():100==c?b.turnRight():122==c?b.moveForward():115==c&&b.moveBack()}),document.addEventListener("mousedown",function(){console.log("Click.")},!1)}(Marvin,Hyacinthe,Isis,this);